---
keywords: fastai
description: So I just updated my (very) remote server from ubuntu 18 to 20 and the process went fairly smooth (except for Nvidia GPU stuff).
title: GPU Issue when upgrading to Ubuntu 20.04
toc: true 
badges: false
comments: true
categories: [Ubuntu, tmux, devops, remote]
image: images/chart-preview.png
nb_path: _notebooks/2020-10-07-Ubuntu_update_gpu_issue.ipynb
layout: notebook
---

<!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-10-07-Ubuntu_update_gpu_issue.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So I just updated my (very) remote server from ubuntu 18 to 20 and the process went fairly smooth (except for Nvidia GPU stuff).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>When I say "very" remote, my server is in Miami, USA. But I am currently studying in Israel lol :)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>I wanted to document some of my issues/useful tools here:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="TOOLS:">TOOLS:<a class="anchor-link" href="#TOOLS:"> </a></h2><ul>
<li><code>tmux</code><ul>
<li><a href="https://github.com/tmux/tmux/wiki">https://github.com/tmux/tmux/wiki</a></li>
<li>I strongly reccomend Oh My Tmux! config found here: <a href="https://github.com/gpakosz/.tmux">https://github.com/gpakosz/.tmux</a><ul>
<li>ctrl+b + m to switch to mouse mode (you'll thank me later)</li>
</ul>
</li>
<li>The reason for this is that you will be making fairly significant changes to your OS while being very far away. All it takes is for your wifi signal to break and god knows what will happen to your ubuntu install. Ubuntu will warn you if you are only using <code>ssh</code> to upgrade.</li>
<li>The other reason is that its just a super dope tool and every developer that uses remote machines must learn it IMO.</li>
</ul>
</li>
<li>Thats it actually</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-upgrade-from-ubuntu-terminal:">How to upgrade from ubuntu terminal:<a class="anchor-link" href="#How-to-upgrade-from-ubuntu-terminal:"> </a></h2><ol>
<li>First run <code>sudo apt-get update &amp;&amp; sudo apt-get upgrade</code></li>
<li>Run <code>do-release-upgrade</code><ul>
<li>This is where you need to have <code>tmux</code> running on your remote machine. Ubuntu should warn you otherwise.</li>
</ul>
</li>
<li>At some point, ubuntu will tell you that there is a local change to your <code>sshd</code> file, and the update wants to override it. This is the file responsible for your ssh configuration. The one you are using to ssh into your machine with. If this file is changed in a way that breaks your ssh connection (for example, if you have a custom port, it will be changed back to 22) and the file is sourced, I think your connection will be broken. Since your machine is remote, you will have no access. So, simply tell the prompt that you will keep the old version of your sshd.</li>
<li>After everything is done installing, run <code>sudo reboot</code></li>
<li>If everything installed okay, and you are able to ssh back in, you can check your OS version with <code>lsb_release -a</code></li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="This-is-where-things-got-bad-:(">This is where things got bad :(<a class="anchor-link" href="#This-is-where-things-got-bad-:("> </a></h3><ol>
<li>Check if your nvidia card is working with <code>nvidia-smi</code>. Mine did not. <ul>
<li>My error: <code>NVIDIA-SMI has failed because it couldn't communicate with the NVIDIA driver. Make sure that the latest NVIDIA driver is installed and running.</code>
An internet search led me to this link: <a href="https://askubuntu.com/questions/927199/nvidia-smi-has-failed-because-it-couldnt-communicate-with-the-nvidia-driver-ma">https://askubuntu.com/questions/927199/nvidia-smi-has-failed-because-it-couldnt-communicate-with-the-nvidia-driver-ma</a> which told me to install <code>nvidia-cuda-toolkit</code>, and <code>prime-select query</code>. Seems a lot of other people were led to disable secureboot (which pissed me off because I dont think its possible to disable secureboot remotely as it is a firmware motherboard thing).</li>
</ul>
</li>
<li>But, I found this tool that you can use to check if you have secureboot enabled or not: <code>mokutil --sb-state</code>. Mine was already disabled.</li>
</ol>
<h3 id="Fix">Fix<a class="anchor-link" href="#Fix"> </a></h3><ol>
<li>Turned out, I just had to install the latest driver :). So lets do that</li>
<li><p>Run <code>ubuntu-drivers devices</code> to find which drivers you need. It will say "recommended" next to the one it recommends 
<img src="/budr_blog/images/copied_from_nb/fastcore_imgs/2020-10-07-Ubuntu_update_gpu_issue/ubuntu-drivers-out.png" alt=""></p>
</li>
<li><p>Install the recommended driver like <code>sudo apt install nvidia-driver-450</code></p>
</li>
<li><p>Run <code>sudo reboot</code> and finally check your <code>nvidia-smi</code> output again :) 
<img src="/budr_blog/images/copied_from_nb/fastcore_imgs/2020-10-07-Ubuntu_update_gpu_issue/nvidia-smi-out.png" alt=""></p>
</li>
</ol>

</div>
</div>
</div>
</div>
 

